<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JAMB Mastermind 3000 - Complete Preparation Platform</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Paystack Inline JS -->
    <script src="https://js.paystack.co/v1/inline.js"></script>
    <style>
        /* Keep all existing CSS styles from the original code */
        :root {
            --primary: #004a99;
            --secondary: #00a859;
            --accent: #ff6b35;
            --light: #f8f9fa;
            --dark: #2d3436;
            --success: #28a745;
            --gold: #FFD700;
            --danger: #dc3545;
            --warning: #ffc107;
            --purple: #6f42c1;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --premium: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        }
        
        body { 
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); 
            min-height: 100vh; 
            padding: 15px; 
        }

        .app-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            position: relative;
        }

        .logo h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-left: 55px;
        }

        .badge {
            background: var(--accent);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            position: absolute;
            top: 15px;
            left: 40px;
        }

        .user-profile {
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            padding: 10px 20px;
            background: rgba(255,255,255,0.15);
            border-radius: 50px;
            transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .user-info:hover {
            background: rgba(255,255,255,0.25);
            border-color: rgba(255,255,255,0.3);
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-plan {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            min-width: 250px;
            display: none;
            z-index: 1000;
            overflow: hidden;
            margin-top: 10px;
        }

        .dropdown-menu.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-menu a {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 25px;
            color: var(--dark);
            text-decoration: none;
            border-bottom: 1px solid #eee;
            transition: all 0.3s;
        }

        .dropdown-menu a:hover {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            transform: translateX(5px);
        }

        .dropdown-divider {
            height: 1px;
            background: #eee;
            margin: 5px 0;
        }

        /* Session Info */
        .session-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 40px;
            background: var(--light);
            border-bottom: 1px solid #e0e0e0;
        }

        .session-timer {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--dark);
        }

        .score-display {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
        }

        /* Navigation */
        .navigation {
            display: flex;
            background: white;
            padding: 0 40px;
            border-bottom: 2px solid #f0f0f0;
            position: relative;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 20px 30px;
            background: none;
            border: none;
            color: var(--dark);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.05rem;
            position: relative;
        }

        .nav-btn:hover {
            color: var(--primary);
            background: rgba(0,74,153,0.05);
        }

        .nav-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
        }

        .nav-btn i {
            font-size: 1.2rem;
        }

        /* Main Content */
        .main-content {
            padding: 40px;
            min-height: 600px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        /* Welcome Banner */
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary), #0066cc);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .welcome-banner h2 {
            font-size: 2.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .welcome-banner p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 800px;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin: 40px 0;
        }

        .stat {
            background: white;
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .stat:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat i {
            font-size: 2.5rem;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
            color: white;
        }

        .stat:nth-child(1) i { background: #e74c3c; }
        .stat:nth-child(2) i { background: #3498db; }
        .stat:nth-child(3) i { background: #2ecc71; }
        .stat:nth-child(4) i { background: #f39c12; }

        .stat h3 {
            font-size: 2.8rem;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .stat p {
            color: #666;
            font-size: 1rem;
        }

        /* Subject Grid */
        .subject-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .subject-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .subject-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }

        .subject-icon {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
            font-size: 2rem;
            color: white;
            position: relative;
            z-index: 1;
        }

        .subject-card h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .subject-card p {
            color: #666;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .question-count {
            display: inline-block;
            background: var(--light);
            padding: 8px 15px;
            border-radius: 25px;
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .premium-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--gold);
            color: var(--dark);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255,215,0,0.3);
        }

        /* Subject Colors */
        .english { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .math { background: linear-gradient(135deg, #3498db, #2980b9); }
        .physics { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
        .chemistry { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .biology { background: linear-gradient(135deg, #1abc9c, #16a085); }
        .government { background: linear-gradient(135deg, #e67e22, #d35400); }
        .economics { background: linear-gradient(135deg, #f1c40f, #f39c12); }
        .literature { background: linear-gradient(135deg, #e84393, #fd79a8); }

        /* Buttons */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), #0066cc);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #003366, #004a99);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,74,153,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #00cc66);
            color: white;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #008744, #00a859);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,168,89,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #34d058);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-premium {
            background: var(--premium);
            color: white;
            box-shadow: 0 10px 25px rgba(102,126,234,0.3);
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(102,126,234,0.4);
        }

        .btn-purple {
            background: linear-gradient(135deg, var(--purple), #8a2be2);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #ff4757);
            color: white;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 50px;
        }

        /* Quiz Section */
        .quiz-section, .results-section {
            display: none;
        }

        .quiz-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .quiz-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quiz-info h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .quiz-timer {
            background: rgba(0,0,0,0.2);
            padding: 15px 25px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
        }

        .quiz-progress {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .question-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border-left: 8px solid var(--primary);
        }

        .question-number {
            display: inline-block;
            background: var(--light);
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 1.4rem;
            line-height: 1.6;
            color: var(--dark);
            margin-bottom: 30px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px 25px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 1.1rem;
        }

        .option:hover {
            border-color: var(--primary);
            background: rgba(0,74,153,0.03);
            transform: translateX(5px);
        }

        .option.selected {
            border-color: var(--primary);
            background: rgba(0,74,153,0.1);
            box-shadow: 0 5px 20px rgba(0,74,153,0.1);
        }

        .option.correct {
            border-color: var(--success);
            background: rgba(40,167,69,0.1);
        }

        .option.wrong {
            border-color: var(--danger);
            background: rgba(220,53,69,0.1);
        }

        .option-letter {
            width: 50px;
            height: 50px;
            background: var(--light);
            color: var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            transition: all 0.3s;
        }

        .option.selected .option-letter {
            background: var(--primary);
            color: white;
        }

        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }

        .option.wrong .option-letter {
            background: var(--danger);
            color: white;
        }

        .quiz-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
        }

        /* Results Section */
        .results-header {
            text-align: center;
            padding: 60px 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 15px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .results-header::before {
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }

        .result-icon {
            font-size: 6rem;
            margin-bottom: 30px;
        }

        .main-score {
            font-size: 5rem;
            font-weight: bold;
            margin: 30px 0;
        }

        .performance-bar {
            width: 100%;
            height: 20px;
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            margin: 30px auto;
            overflow: hidden;
            max-width: 600px;
        }

        .performance-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .result-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .result-card h3 {
            color: #666;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .result-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dark);
        }

        .detailed-results {
            background: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 40px;
            box-shadow: var(--shadow);
        }

        .question-review {
            padding: 25px;
            border-bottom: 1px solid #eee;
        }

        .question-review:last-child {
            border-bottom: none;
        }

        /* Billing & Subscription Styles */
        .billing-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .plan-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin: 40px 0;
        }

        .plan-card {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            position: relative;
            border: 2px solid transparent;
        }

        .plan-card:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
        }

        .plan-card.popular {
            border: 2px solid var(--gold);
            transform: scale(1.05);
        }

        .popular-badge {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--gold);
            color: var(--dark);
            padding: 8px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .plan-name {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .plan-price {
            font-size: 3rem;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 20px;
        }

        .plan-price span {
            font-size: 1.2rem;
            color: #666;
        }

        .plan-features {
            list-style: none;
            padding: 0;
            margin: 30px 0;
        }

        .plan-features li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .plan-features li i {
            color: var(--success);
        }

        .subscription-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .subscription-info h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .subscription-badge {
            padding: 8px 20px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .badge-active {
            background: #d4edda;
            color: #155724;
        }

        .badge-expired {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-trial {
            background: #fff3cd;
            color: #856404;
        }

        .transaction-history {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-details {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .transaction-icon {
            width: 50px;
            height: 50px;
            background: var(--light);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .transaction-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .invoice-btn {
            padding: 8px 20px;
            background: var(--light);
            border-radius: 20px;
            color: var(--dark);
            text-decoration: none;
            font-size: 0.9rem;
        }

        .invoice-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            width: 100%;
            max-width: 600px;
            border-radius: 20px;
            overflow: hidden;
            animation: modalIn 0.4s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            padding: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2.5rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .modal-body {
            padding: 40px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            background: var(--success);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 3000;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 300px;
            max-width: 400px;
        }

        .notification.error { background: var(--danger); }
        .notification.warning { background: var(--warning); color: var(--dark); }
        .notification.info { background: #17a2b8; }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .subject-grid,
            .quick-stats,
            .results-grid,
            .plan-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .navigation {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .subject-grid,
            .quick-stats,
            .results-grid,
            .plan-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .quiz-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .quiz-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }

            .subscription-card {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
        }

        @media (max-width: 480px) {
            .main-content,
            .header,
            .navigation,
            .session-info {
                padding: 20px;
            }
            
            .welcome-banner h2 {
                font-size: 1.8rem;
            }
            
            .question-card {
                padding: 20px;
            }
            
            .option {
                padding: 15px;
            }
        }

        /* Animations */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .float {
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="badge" id="plan-badge">PRO EDITION</div>
                <h1><i class="fas fa-brain"></i> JAMB Mastermind 3000+</h1>
                <p class="subtitle">Complete Preparation Platform for 2024/2025 Session</p>
            </div>
            <div class="user-profile">
                <div class="user-info" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="user-avatar">
                        <i class="fas fa-user-graduate"></i>
                    </div>
                    <div>
                        <div class="user-name" id="user-name">Future Graduate</div>
                        <div class="user-plan" id="user-plan">FREE ACCESS</div>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="dropdown-menu" id="user-dropdown">
                    <a href="#" onclick="viewProfile()">
                        <i class="fas fa-user-circle"></i>
                        <div>
                            <strong>My Profile</strong>
                            <small>View progress & achievements</small>
                        </div>
                    </a>
                    <a href="#" onclick="openTab('billing-tab')">
                        <i class="fas fa-credit-card"></i>
                        <div>
                            <strong>Billing & Subscription</strong>
                            <small>Manage your plan and invoices</small>
                        </div>
                    </a>
                    <a href="#" onclick="viewAnalytics()">
                        <i class="fas fa-chart-bar"></i>
                        <div>
                            <strong>Analytics</strong>
                            <small>Performance insights</small>
                        </div>
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="#" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <div>
                            <strong>Logout</strong>
                            <small>End current session</small>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Session Info -->
        <div class="session-info">
            <div class="session-timer">
                <i class="far fa-clock"></i>
                <span>Session Time: <span id="session-time">00:00:00</span></span>
            </div>
            <div class="score-display">
                <i class="fas fa-trophy"></i>
                Total Score: <span id="total-score-display">0</span> points
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button class="nav-btn active" onclick="openTab('practice-tab')">
                <i class="fas fa-book-open"></i> Practice Mode
            </button>
            <button class="nav-btn" onclick="openTab('mock-tab')">
                <i class="fas fa-clipboard-list"></i> Mock Exams
            </button>
            <button class="nav-btn" onclick="openTab('analytics-tab')">
                <i class="fas fa-chart-line"></i> Analytics
            </button>
            <button class="nav-btn" onclick="openTab('billing-tab')">
                <i class="fas fa-credit-card"></i> Billing
            </button>
            <button class="nav-btn" onclick="openTab('premium-tab')">
                <i class="fas fa-crown"></i> Premium
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard -->
            <div id="dashboard">
                <!-- Practice Tab -->
                <div id="practice-tab" class="tab-content">
                    <div class="welcome-banner">
                        <h2><i class="fas fa-graduation-cap"></i> Master JAMB with 3000+ Curated Questions</h2>
                        <p>Comprehensive preparation across all subjects. Track progress, identify weak areas, and achieve your target score.</p>
                    </div>

                    <div class="quick-stats">
                        <div class="stat">
                            <i class="fas fa-question-circle"></i>
                            <div>
                                <h3 id="questions-attempted">0</h3>
                                <p>Questions Attempted</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-chart-line"></i>
                            <div>
                                <h3 id="accuracy-rate">0%</h3>
                                <p>Accuracy Rate</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-medal"></i>
                            <div>
                                <h3 id="streak-days">0</h3>
                                <p>Day Streak</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <div>
                                <h3 id="study-hours">0</h3>
                                <p>Study Hours</p>
                            </div>
                        </div>
                    </div>

                    <div class="subject-grid">
                        <!-- English -->
                        <div class="subject-card" onclick="checkPremiumAndStart('english')">
                            <div class="subject-icon english float">
                                <i class="fas fa-language"></i>
                            </div>
                            <h3>English Language</h3>
                            <p>Comprehension, Grammar, Vocabulary, Oral English</p>
                            <div class="question-count" id="english-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Mathematics -->
                        <div class="subject-card" onclick="checkPremiumAndStart('math')">
                            <div class="subject-icon math float">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <h3>Mathematics</h3>
                            <p>Algebra, Geometry, Calculus, Statistics</p>
                            <div class="question-count" id="math-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Physics -->
                        <div class="subject-card" onclick="checkPremiumAndStart('physics')">
                            <div class="subject-icon physics float">
                                <i class="fas fa-atom"></i>
                            </div>
                            <h3>Physics</h3>
                            <p>Mechanics, Waves, Electricity, Modern Physics</p>
                            <div class="question-count" id="physics-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Chemistry -->
                        <div class="subject-card" onclick="checkPremiumAndStart('chemistry')">
                            <div class="subject-icon chemistry float">
                                <i class="fas fa-flask"></i>
                            </div>
                            <h3>Chemistry</h3>
                            <p>Organic, Inorganic, Physical Chemistry</p>
                            <div class="question-count" id="chemistry-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Biology -->
                        <div class="subject-card" onclick="checkPremiumAndStart('biology')">
                            <div class="subject-icon biology float">
                                <i class="fas fa-dna"></i>
                            </div>
                            <h3>Biology</h3>
                            <p>Genetics, Ecology, Human Physiology, Botany</p>
                            <div class="question-count" id="biology-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Government -->
                        <div class="subject-card" onclick="checkPremiumAndStart('government')">
                            <div class="subject-icon government float">
                                <i class="fas fa-landmark"></i>
                            </div>
                            <h3>Government</h3>
                            <p>Political Theory, Nigerian Government, Constitution</p>
                            <div class="question-count" id="government-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Economics -->
                        <div class="subject-card" onclick="checkPremiumAndStart('economics')">
                            <div class="subject-icon economics float">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Economics</h3>
                            <p>Microeconomics, Macroeconomics, Development</p>
                            <div class="question-count" id="economics-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>

                        <!-- Literature -->
                        <div class="subject-card" onclick="checkPremiumAndStart('literature')">
                            <div class="subject-icon literature float">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3>Literature in English</h3>
                            <p>Prose, Poetry, Drama, Literary Devices</p>
                            <div class="question-count" id="literature-count">500+ Questions</div>
                            <div class="premium-tag">Premium</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary btn-lg" onclick="quickRevision()">
                            <i class="fas fa-bolt"></i> Quick Revision (30 Questions)
                        </button>
                        <button class="btn btn-secondary btn-lg" onclick="openTab('mock-tab')">
                            <i class="fas fa-clipboard-check"></i> Full Mock Test
                        </button>
                        <button class="btn btn-premium btn-lg" onclick="openTab('billing-tab')">
                            <i class="fas fa-crown"></i> Go Premium
                        </button>
                    </div>
                </div>

                <!-- Mock Exams Tab -->
                <div id="mock-tab" class="tab-content" style="display: none;">
                    <div class="welcome-banner">
                        <h2><i class="fas fa-clipboard-list"></i> JAMB Mock Examination Center</h2>
                        <p>Simulate the real JAMB exam experience with timed tests, detailed analytics, and performance tracking</p>
                    </div>

                    <div class="quick-stats">
                        <div class="stat">
                            <i class="fas fa-trophy"></i>
                            <div>
                                <h3 id="mock-score">0</h3>
                                <p>Best Mock Score</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-history"></i>
                            <div>
                                <h3 id="mock-attempts">0</h3>
                                <p>Mock Attempts</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-clock"></i>
                            <div>
                                <h3 id="avg-time">00:00</h3>
                                <p>Average Time</p>
                            </div>
                        </div>
                        <div class="stat">
                            <i class="fas fa-chart-pie"></i>
                            <div>
                                <h3 id="accuracy-mock">0%</h3>
                                <p>Mock Accuracy</p>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 50px 0;">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">Select Mock Exam Type</h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; max-width: 1000px; margin: 0 auto;">
                            <div class="subject-card" onclick="checkPremiumAndStartMock('full', 180, 7200)">
                                <div class="subject-icon english" style="background: var(--primary);">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                <h3>Full JAMB Mock</h3>
                                <p>180 Questions • 2 Hours</p>
                                <div class="question-count">Complete Simulation</div>
                                <button class="btn btn-primary" style="margin-top: 15px;">Start Exam</button>
                            </div>

                            <div class="subject-card" onclick="checkPremiumAndStartMock('custom', 60, 3600)">
                                <div class="subject-icon math" style="background: var(--secondary);">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <h3>Custom Mock</h3>
                                <p>60 Questions • 1 Hour</p>
                                <div class="question-count">Choose Subjects</div>
                                <button class="btn btn-secondary" style="margin-top: 15px;">Customize</button>
                            </div>

                            <div class="subject-card" onclick="checkPremiumAndStartMock('speed', 40, 1800)">
                                <div class="subject-icon physics" style="background: var(--accent);">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <h3>Speed Test</h3>
                                <p>40 Questions • 30 Minutes</p>
                                <div class="question-count">Quick Assessment</div>
                                <button class="btn btn-danger" style="margin-top: 15px;">Start Test</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics-tab" class="tab-content" style="display: none;">
                    <div class="welcome-banner">
                        <h2><i class="fas fa-chart-line"></i> Performance Analytics & Insights</h2>
                        <p>Track your progress, identify weak areas, and optimize your study strategy</p>
                    </div>
                    <div style="text-align: center; padding: 60px 0;">
                        <i class="fas fa-chart-pie" style="font-size: 5rem; color: var(--primary); opacity: 0.5;"></i>
                        <h3 style="margin-top: 20px; color: #666;">Analytics dashboard coming soon!</h3>
                        <p style="color: #999; margin-top: 10px;">Unlock detailed insights with Premium plan</p>
                        <button class="btn btn-premium" style="margin-top: 30px;" onclick="openTab('billing-tab')">
                            <i class="fas fa-crown"></i> Go Premium
                        </button>
                    </div>
                </div>

                <!-- Billing Tab (New) -->
                <div id="billing-tab" class="tab-content" style="display: none;">
                    <div class="welcome-banner">
                        <h2><i class="fas fa-credit-card"></i> Billing & Subscription</h2>
                        <p>Manage your subscription, view invoices, and upgrade your learning experience</p>
                    </div>

                    <!-- Current Subscription Status -->
                    <div id="subscription-status-container"></div>

                    <!-- Subscription Plans -->
                    <div style="margin-top: 50px;">
                        <h2 style="color: var(--primary); text-align: center; margin-bottom: 40px;">Choose Your Plan</h2>
                        <div class="plan-grid" id="plan-grid-container"></div>
                    </div>

                    <!-- Transaction History -->
                    <div style="margin-top: 60px;">
                        <h2 style="color: var(--primary); margin-bottom: 30px;">Transaction History</h2>
                        <div class="transaction-history" id="transaction-history-container"></div>
                    </div>
                </div>

                <!-- Premium Tab -->
                <div id="premium-tab" class="tab-content" style="display: none;">
                    <div class="welcome-banner">
                        <h2><i class="fas fa-crown"></i> Unlock Premium Features</h2>
                        <p>Get full access to all 3000+ questions, unlimited mock exams, and advanced analytics</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin: 50px 0;">
                        <div class="subject-card" style="text-align: center;">
                            <i class="fas fa-infinity" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                            <h3>Unlimited Practice</h3>
                            <p>Access all 3000+ questions across 8 subjects</p>
                        </div>
                        <div class="subject-card" style="text-align: center;">
                            <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--secondary); margin-bottom: 20px;"></i>
                            <h3>Advanced Analytics</h3>
                            <p>Detailed performance insights and weak area identification</p>
                        </div>
                        <div class="subject-card" style="text-align: center;">
                            <i class="fas fa-file-alt" style="font-size: 3rem; color: var(--accent); margin-bottom: 20px;"></i>
                            <h3>Unlimited Mocks</h3>
                            <p>Take unlimited full-length mock exams</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn btn-premium btn-lg" onclick="openTab('billing-tab')">
                            <i class="fas fa-credit-card"></i> View Subscription Plans
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div id="quiz-section" class="quiz-section"></div>

            <!-- Results Section -->
            <div id="results-section" class="results-section"></div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-lock"></i> Complete Your Subscription</h3>
                <button class="close-btn" onclick="closePaymentModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="text-align: center; margin-bottom: 30px;" id="payment-modal-details">
                    <!-- Dynamic payment details will be inserted here -->
                </div>
                <div id="payment-modal-content">
                    <!-- Payment processing content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div id="invoice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, var(--purple), var(--primary));">
                <h3><i class="fas fa-file-invoice"></i> Invoice Details</h3>
                <button class="close-btn" onclick="closeInvoiceModal()">&times;</button>
            </div>
            <div class="modal-body" id="invoice-modal-content">
                <!-- Invoice details will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        // =============== PAYSTACK CONFIGURATION ===============
        const PAYSTACK_PUBLIC_KEY = 'pk_test_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'; // Replace with your Paystack public key
        
        // Subscription Plans
        const SUBSCRIPTION_PLANS = {
            monthly: {
                name: 'Monthly Premium',
                price: 5000,
                priceLabel: '₦5,000',
                period: 'month',
                features: [
                    'Access to all 3000+ questions',
                    'Unlimited mock exams',
                    'Detailed analytics & reports',
                    'Priority email support',
                    'Cancel anytime'
                ]
            },
            quarterly: {
                name: 'Quarterly Premium',
                price: 13500,
                priceLabel: '₦13,500',
                period: '3 months',
                features: [
                    'All Monthly features',
                    'Save 10% (₦1,500 off)',
                    'Extended access',
                    'Progress tracking',
                    'WhatsApp support group'
                ]
            },
            yearly: {
                name: 'Yearly Premium',
                price: 45000,
                priceLabel: '₦45,000',
                period: 'year',
                features: [
                    'All Quarterly features',
                    'Save 25% (₦15,000 off)',
                    'Best value',
                    'Personalized study plan',
                    '1-on-1 consultation'
                ]
            }
        };

        // =============== APP STATE ===============
        const APP_STATE = {
            currentUser: {
                name: 'Future Graduate',
                email: 'student@example.com',
                plan: 'free',
                subscription: {
                    type: null,
                    status: 'inactive',
                    startDate: null,
                    endDate: null,
                    autoRenew: false
                },
                questionsAttempted: 0,
                correctAnswers: 0,
                totalScore: 0,
                mockExamsTaken: 0,
                studyTime: 0,
                streakDays: 7,
                lastActive: new Date().toISOString()
            },
            currentSession: {
                subject: null,
                questions: [],
                currentIndex: 0,
                score: 0,
                selectedAnswers: [],
                startTime: null,
                isMockExam: false,
                mockConfig: null,
                timer: null,
                timeRemaining: 0
            },
            transactions: [
                {
                    id: 'TXN001',
                    date: '2024-01-15',
                    plan: 'Monthly Premium',
                    amount: 5000,
                    status: 'success',
                    reference: 'PAYSTACK_REF_001',
                    paymentMethod: 'Card'
                },
                {
                    id: 'TXN002',
                    date: '2024-02-15',
                    plan: 'Monthly Premium',
                    amount: 5000,
                    status: 'success',
                    reference: 'PAYSTACK_REF_002',
                    paymentMethod: 'Card'
                }
            ],
            sessionStartTime: null,
            sessionTimer: null
        };

        // =============== QUESTION DATABASE ===============
        const QUESTION_DATABASE = {
            english: [
                {
                    id: "ENG001",
                    question: "Choose the option that has the same vowel sound as the one represented by the letter(s) underlined: 'b<u>oo</u>k'",
                    options: ["cook", "boot", "moon", "soon"],
                    correct: 0,
                    explanation: "The 'oo' in 'book' makes the /ʊ/ sound as in 'cook', not the /u:/ sound as in 'boot', 'moon', or 'soon'.",
                    topic: "Phonetics",
                    difficulty: "easy"
                },
                {
                    id: "ENG002",
                    question: "Select the word that has the correct stress pattern: 'education'",
                    options: ["ED-u-ca-tion", "e-DU-ca-tion", "e-du-CA-tion", "e-du-ca-TION"],
                    correct: 2,
                    explanation: "The correct stress in 'education' falls on the third syllable: e-du-CA-tion.",
                    topic: "Stress",
                    difficulty: "medium"
                },
                {
                    id: "ENG003",
                    question: "Choose the option that best completes the sentence: 'Neither the students nor the teacher _____ aware of the changes.'",
                    options: ["was", "were", "are", "have been"],
                    correct: 0,
                    explanation: "When using 'neither...nor', the verb agrees with the subject closest to it. 'Teacher' is singular, so we use 'was'.",
                    topic: "Concord",
                    difficulty: "medium"
                },
                {
                    id: "ENG004",
                    question: "Identify the sentence with the correct punctuation:",
                    options: [
                        "The man who is wearing a blue shirt, is my brother.",
                        "The man, who is wearing a blue shirt is my brother.",
                        "The man who is wearing a blue shirt is my brother.",
                        "The man, who is wearing a blue shirt, is my brother."
                    ],
                    correct: 2,
                    explanation: "No commas are needed because 'who is wearing a blue shirt' is a restrictive clause essential to the meaning.",
                    topic: "Punctuation",
                    difficulty: "hard"
                },
                {
                    id: "ENG005",
                    question: "Choose the option that means the opposite of 'MAGNANIMOUS':",
                    options: ["generous", "petty", "courageous", "wealthy"],
                    correct: 1,
                    explanation: "Magnanimous means generous or forgiving, especially toward a rival. The opposite is petty.",
                    topic: "Antonyms",
                    difficulty: "medium"
                }
            ],
            
            math: [
                {
                    id: "MATH001",
                    question: "Simplify: (3x² - 2x + 5) + (2x² + 3x - 1)",
                    options: ["5x² + x + 4", "5x² - 5x + 6", "x² + 5x + 4", "5x² + 5x + 6"],
                    correct: 0,
                    explanation: "Combine like terms: 3x² + 2x² = 5x²; -2x + 3x = x; 5 + (-1) = 4",
                    topic: "Algebra",
                    difficulty: "easy"
                },
                {
                    id: "MATH002",
                    question: "If y varies directly as x² and y = 12 when x = 2, find y when x = 5",
                    options: ["30", "75", "48", "60"],
                    correct: 1,
                    explanation: "y = kx². First find k: 12 = k(2)² => k = 3. Then y = 3(5)² = 3(25) = 75",
                    topic: "Variation",
                    difficulty: "medium"
                },
                {
                    id: "MATH003",
                    question: "A triangle has sides 6cm, 8cm, and 10cm. What type of triangle is it?",
                    options: ["Acute", "Obtuse", "Right-angled", "Equilateral"],
                    correct: 2,
                    explanation: "Check Pythagorean theorem: 6² + 8² = 36 + 64 = 100 = 10². Therefore it's right-angled.",
                    topic: "Geometry",
                    difficulty: "easy"
                },
                {
                    id: "MATH004",
                    question: "Find the derivative of f(x) = 3x³ - 2x² + 5x - 1",
                    options: ["9x² - 4x + 5", "6x² - 4x + 5", "9x² - 2x + 5", "3x² - 2x + 5"],
                    correct: 0,
                    explanation: "Using power rule: d/dx(3x³) = 9x²; d/dx(-2x²) = -4x; d/dx(5x) = 5; d/dx(-1) = 0",
                    topic: "Calculus",
                    difficulty: "medium"
                },
                {
                    id: "MATH005",
                    question: "In how many ways can 5 students be arranged in a row?",
                    options: ["25", "60", "120", "625"],
                    correct: 2,
                    explanation: "5! = 5 × 4 × 3 × 2 × 1 = 120 ways",
                    topic: "Permutations",
                    difficulty: "easy"
                }
            ],
            
            physics: [
                {
                    id: "PHY001",
                    question: "Which of the following is a vector quantity?",
                    options: ["Mass", "Temperature", "Distance", "Velocity"],
                    correct: 3,
                    explanation: "Velocity has both magnitude and direction, making it a vector quantity.",
                    topic: "Measurement",
                    difficulty: "easy"
                }
            ],
            
            chemistry: [
                {
                    id: "CHEM001",
                    question: "Which of the following elements is a halogen?",
                    options: ["Sodium", "Chlorine", "Calcium", "Iron"],
                    correct: 1,
                    explanation: "Chlorine is in group 17, the halogen group.",
                    topic: "Periodic Table",
                    difficulty: "easy"
                }
            ],
            
            biology: [
                {
                    id: "BIO001",
                    question: "Which organelle is responsible for protein synthesis?",
                    options: ["Mitochondria", "Ribosome", "Nucleus", "Golgi apparatus"],
                    correct: 1,
                    explanation: "Ribosomes are the sites of protein synthesis in cells.",
                    topic: "Cell Biology",
                    difficulty: "easy"
                }
            ],
            
            government: [
                {
                    id: "GOV001",
                    question: "The first military coup in Nigeria occurred in which year?",
                    options: ["1960", "1966", "1970", "1975"],
                    correct: 1,
                    explanation: "The first military coup in Nigeria took place on January 15, 1966.",
                    topic: "Nigerian Government",
                    difficulty: "easy"
                }
            ],
            
            economics: [
                {
                    id: "ECO001",
                    question: "What does GDP stand for?",
                    options: [
                        "Gross Domestic Product",
                        "General Domestic Price",
                        "Gross Development Plan",
                        "General Development Product"
                    ],
                    correct: 0,
                    explanation: "GDP stands for Gross Domestic Product, the total value of goods produced and services provided in a country.",
                    topic: "Macroeconomics",
                    difficulty: "easy"
                }
            ],
            
            literature: [
                {
                    id: "LIT001",
                    question: "Who wrote 'Things Fall Apart'?",
                    options: ["Wole Soyinka", "Chinua Achebe", "Chimamanda Adichie", "Ben Okri"],
                    correct: 1,
                    explanation: "'Things Fall Apart' was written by Chinua Achebe, published in 1958.",
                    topic: "African Literature",
                    difficulty: "easy"
                }
            ]
        };

        // Fill remaining questions with generated content
        function fillQuestionDatabase() {
            const subjects = Object.keys(QUESTION_DATABASE);
            const topics = {
                english: ["Comprehension", "Grammar", "Vocabulary", "Oral English", "Literary Appreciation"],
                math: ["Algebra", "Geometry", "Calculus", "Statistics", "Trigonometry"],
                physics: ["Mechanics", "Waves", "Electricity", "Thermodynamics", "Modern Physics"],
                chemistry: ["Organic", "Inorganic", "Physical", "Analytical", "Industrial"],
                biology: ["Genetics", "Ecology", "Physiology", "Botany", "Zoology"],
                government: ["Political Theory", "Nigerian Government", "Constitution", "International Relations", "Public Administration"],
                economics: ["Microeconomics", "Macroeconomics", "Development", "International", "Mathematics for Economics"],
                literature: ["Prose", "Poetry", "Drama", "Literary Devices", "African Literature"]
            };

            subjects.forEach(subject => {
                const currentCount = QUESTION_DATABASE[subject].length;
                const targetCount = 10; // Reduced to 10 for testing
                
                for (let i = currentCount + 1; i <= targetCount; i++) {
                    const topicIndex = Math.floor((i-1) / 2) % topics[subject].length;
                    const topic = topics[subject][topicIndex];
                    const difficulty = i <= 3 ? "easy" : i <= 7 ? "medium" : "hard";
                    
                    QUESTION_DATABASE[subject].push({
                        id: `${subject.toUpperCase()}${String(i).padStart(3, '0')}`,
                        question: `${subject.charAt(0).toUpperCase() + subject.slice(1)} Question ${i}: What is the correct answer to this ${topic} question?`,
                        options: [
                            `Option A for question ${i}`,
                            `Option B for question ${i}`,
                            `Option C for question ${i}`,
                            `Option D for question ${i}`
                        ],
                        correct: Math.floor(Math.random() * 4),
                        explanation: `This is the detailed explanation for question ${i} in ${subject}, topic: ${topic}. The correct answer is based on fundamental principles of ${topic.toLowerCase()}.`,
                        topic: topic,
                        difficulty: difficulty
                    });
                }
            });
        }

        fillQuestionDatabase();

        // =============== INITIALIZATION ===============
        window.onload = function() {
            openTab('practice-tab');
            startSessionTimer();
            updateStats();
            updateQuestionCounts();
            loadBillingData();
            checkSubscriptionStatus();
            showNotification('success', '🎓 Welcome to JAMB Mastermind 3000+! Start your preparation now.');
        };

        // =============== PAYSTACK PAYMENT HANDLER ===============
        function initiatePaystackPayment(plan, amount, email) {
            const handler = PaystackPop.setup({
                key: PAYSTACK_PUBLIC_KEY,
                email: email || APP_STATE.currentUser.email,
                amount: amount * 100, // Convert to kobo
                currency: 'NGN',
                ref: 'JAMB_' + Math.floor((Math.random() * 1000000000) + 1),
                metadata: {
                    plan_name: plan,
                    user_name: APP_STATE.currentUser.name,
                    custom_fields: [
                        {
                            display_name: "Plan",
                            variable_name: "plan",
                            value: plan
                        },
                        {
                            display_name: "User",
                            variable_name: "user",
                            value: APP_STATE.currentUser.name
                        }
                    ]
                },
                callback: function(response) {
                    // Payment successful
                    console.log('Payment successful:', response);
                    const transaction = {
                        id: 'TXN' + Date.now(),
                        date: new Date().toISOString().split('T')[0],
                        plan: plan,
                        amount: amount,
                        status: 'success',
                        reference: response.reference,
                        paymentMethod: 'Paystack'
                    };
                    
                    APP_STATE.transactions.unshift(transaction);
                    activatePremiumSubscription(plan);
                    closePaymentModal();
                    showNotification('success', `🎉 Payment successful! Your ${plan} plan is now active.`);
                    
                    // Store transaction in localStorage
                    saveTransactions();
                    loadBillingData();
                },
                onClose: function() {
                    showNotification('warning', 'Payment cancelled. You can try again anytime.');
                }
            });
            
            handler.openIframe();
        }

        // =============== BILLING FUNCTIONS ===============
        function loadBillingData() {
            loadSubscriptionStatus();
            loadPlans();
            loadTransactionHistory();
        }

        function loadSubscriptionStatus() {
            const container = document.getElementById('subscription-status-container');
            const user = APP_STATE.currentUser;
            
            if (user.plan === 'premium' && user.subscription.status === 'active') {
                const endDate = new Date(user.subscription.endDate);
                const daysRemaining = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
                
                container.innerHTML = `
                    <div class="subscription-card">
                        <div style="display: flex; align-items: center; gap: 25px;">
                            <div style="width: 70px; height: 70px; background: linear-gradient(135deg, var(--success), #34d058); border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-crown" style="font-size: 2.5rem; color: white;"></i>
                            </div>
                            <div class="subscription-info">
                                <h3 style="font-size: 1.8rem;">${user.subscription.type} Plan</h3>
                                <p style="color: #666; margin-top: 5px;">
                                    <i class="fas fa-calendar"></i> Started: ${new Date(user.subscription.startDate).toLocaleDateString()} |
                                    <i class="fas fa-hourglass-half"></i> Expires: ${new Date(user.subscription.endDate).toLocaleDateString()}
                                </p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <span class="subscription-badge badge-active">
                                <i class="fas fa-check-circle"></i> Active
                            </span>
                            <p style="margin-top: 10px; color: var(--primary); font-weight: bold;">
                                ${daysRemaining} days remaining
                            </p>
                            <button class="btn btn-outline" style="margin-top: 15px;" onclick="showRenewalModal()">
                                <i class="fas fa-redo"></i> Renew
                            </button>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <div class="subscription-card" style="background: linear-gradient(135deg, #f8f9fa, #e9ecef);">
                        <div style="display: flex; align-items: center; gap: 25px;">
                            <div style="width: 70px; height: 70px; background: var(--light); border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-lock" style="font-size: 2.5rem; color: var(--dark);"></i>
                            </div>
                            <div class="subscription-info">
                                <h3 style="font-size: 1.8rem;">Free Plan</h3>
                                <p style="color: #666; margin-top: 5px;">
                                    <i class="fas fa-info-circle"></i> Upgrade to access all 3000+ questions and premium features
                                </p>
                            </div>
                        </div>
                        <div>
                            <button class="btn btn-premium btn-lg" onclick="scrollToPlans()">
                                <i class="fas fa-crown"></i> Upgrade Now
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function loadPlans() {
            const container = document.getElementById('plan-grid-container');
            let html = '';
            
            Object.keys(SUBSCRIPTION_PLANS).forEach((key, index) => {
                const plan = SUBSCRIPTION_PLANS[key];
                const isPopular = key === 'quarterly';
                
                html += `
                    <div class="plan-card ${isPopular ? 'popular' : ''}">
                        ${isPopular ? '<div class="popular-badge">MOST POPULAR</div>' : ''}
                        <div class="plan-name">${plan.name}</div>
                        <div class="plan-price">
                            ${plan.priceLabel}
                            <span>/${plan.period}</span>
                        </div>
                        <ul class="plan-features">
                            ${plan.features.map(feature => `
                                <li>
                                    <i class="fas fa-check-circle"></i>
                                    ${feature}
                                </li>
                            `).join('')}
                        </ul>
                        <button class="btn ${key === 'yearly' ? 'btn-success' : key === 'quarterly' ? 'btn-primary' : 'btn-secondary'}" 
                                onclick="showPaymentModal('${key}')" 
                                style="width: 100%; padding: 15px; font-size: 1.1rem;">
                            <i class="fas fa-lock"></i> Subscribe Now
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function loadTransactionHistory() {
            const container = document.getElementById('transaction-history-container');
            
            if (APP_STATE.transactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <i class="fas fa-receipt" style="font-size: 4rem; color: #ccc; margin-bottom: 20px;"></i>
                        <h3 style="color: #666; margin-bottom: 10px;">No transactions yet</h3>
                        <p style="color: #999;">Your payment history will appear here</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px; background: var(--light); border-radius: 12px; margin-bottom: 20px;">
                    <div><strong>Transaction</strong></div>
                    <div><strong>Plan</strong></div>
                    <div><strong>Amount</strong></div>
                    <div><strong>Status</strong></div>
                    <div><strong>Date</strong></div>
                    <div></div>
                </div>
            `;
            
            APP_STATE.transactions.forEach(tx => {
                html += `
                    <div class="transaction-item">
                        <div class="transaction-details">
                            <div class="transaction-icon">
                                <i class="fas fa-file-invoice"></i>
                            </div>
                            <div>
                                <strong>${tx.id}</strong>
                                <div style="font-size: 0.85rem; color: #666;">Ref: ${tx.reference}</div>
                            </div>
                        </div>
                        <div>${tx.plan}</div>
                        <div><strong>₦${tx.amount.toLocaleString()}</strong></div>
                        <div>
                            <span class="transaction-status status-${tx.status}">
                                ${tx.status.toUpperCase()}
                            </span>
                        </div>
                        <div style="color: #666;">${new Date(tx.date).toLocaleDateString()}</div>
                        <div>
                            <button class="invoice-btn" onclick="viewInvoice('${tx.id}')">
                                <i class="fas fa-download"></i> Invoice
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        function saveTransactions() {
            localStorage.setItem('jamb_transactions', JSON.stringify(APP_STATE.transactions));
        }

        function showPaymentModal(planKey) {
            const plan = SUBSCRIPTION_PLANS[planKey];
            const modal = document.getElementById('payment-modal');
            const modalDetails = document.getElementById('payment-modal-details');
            
            modalDetails.innerHTML = `
                <div class="subject-icon english" style="margin: 0 auto 20px; width: 80px; height: 80px;">
                    <i class="fas fa-crown"></i>
                </div>
                <h2 style="color: var(--primary);">${plan.name}</h2>
                <p style="color: #666; margin: 10px 0 20px;">${plan.period} access to all premium features</p>
                <div style="font-size: 3rem; font-weight: bold; color: var(--primary); margin: 20px 0;">
                    ${plan.priceLabel}
                </div>
            `;
            
            document.getElementById('payment-modal-content').innerHTML = `
                <div style="background: var(--light); padding: 20px; border-radius: 12px; margin: 20px 0;">
                    <h4 style="margin-bottom: 15px; color: var(--dark);">What You Get:</h4>
                    <ul style="list-style: none; padding: 0;">
                        ${plan.features.map(feature => `
                            <li style="padding: 10px 0; border-bottom: 1px solid #ddd; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-check-circle" style="color: var(--success);"></i>
                                <span>${feature}</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
                
                <div style="display: flex; gap: 15px;">
                    <button class="btn btn-success" onclick="processPaystackPayment('${planKey}', ${plan.price})" style="flex: 2; padding: 18px; font-size: 1.2rem;">
                        <i class="fas fa-lock"></i> Pay with Paystack
                    </button>
                    <button class="btn btn-outline" onclick="closePaymentModal()" style="flex: 1; padding: 18px;">
                        Cancel
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function processPaystackPayment(planKey, amount) {
            const email = prompt("Please enter your email address for payment receipt:", APP_STATE.currentUser.email);
            if (email) {
                APP_STATE.currentUser.email = email;
                initiatePaystackPayment(SUBSCRIPTION_PLANS[planKey].name, amount, email);
            }
        }

        function closePaymentModal() {
            document.getElementById('payment-modal').style.display = 'none';
        }

        function activatePremiumSubscription(planName) {
            const now = new Date();
            const endDate = new Date();
            
            if (planName.includes('Yearly')) {
                endDate.setFullYear(endDate.getFullYear() + 1);
            } else if (planName.includes('Quarterly')) {
                endDate.setMonth(endDate.getMonth() + 3);
            } else {
                endDate.setMonth(endDate.getMonth() + 1);
            }
            
            APP_STATE.currentUser.plan = 'premium';
            APP_STATE.currentUser.subscription = {
                type: planName,
                status: 'active',
                startDate: now.toISOString(),
                endDate: endDate.toISOString(),
                autoRenew: false
            };
            
            document.getElementById('user-plan').textContent = 'PREMIUM ACCESS';
            document.getElementById('user-avatar').style.background = 'var(--premium)';
            document.getElementById('plan-badge').textContent = 'PREMIUM EDITION';
            
            showNotification('success', `🎉 Welcome to ${planName}! All premium features unlocked.`);
            saveUserData();
            loadBillingData();
        }

        function checkSubscriptionStatus() {
            const sub = APP_STATE.currentUser.subscription;
            if (sub.status === 'active' && sub.endDate) {
                const now = new Date();
                const expiry = new Date(sub.endDate);
                
                if (now > expiry) {
                    APP_STATE.currentUser.plan = 'free';
                    APP_STATE.currentUser.subscription.status = 'expired';
                    document.getElementById('user-plan').textContent = 'FREE ACCESS';
                    document.getElementById('user-avatar').style.background = 'rgba(255,255,255,0.2)';
                    document.getElementById('plan-badge').textContent = 'FREE EDITION';
                    
                    showNotification('warning', 'Your subscription has expired. Renew now to continue accessing premium features!');
                }
            }
        }

        function showRenewalModal() {
            showPaymentModal('monthly');
        }

        function scrollToPlans() {
            const container = document.getElementById('plan-grid-container');
            container.scrollIntoView({ behavior: 'smooth' });
        }

        function viewInvoice(transactionId) {
            const transaction = APP_STATE.transactions.find(tx => tx.id === transactionId);
            if (!transaction) return;
            
            const modal = document.getElementById('invoice-modal');
            const content = document.getElementById('invoice-modal-content');
            
            const invoiceDate = new Date(transaction.date);
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div style="width: 100px; height: 100px; background: linear-gradient(135deg, var(--purple), var(--primary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                        <i class="fas fa-file-invoice" style="font-size: 3rem; color: white;"></i>
                    </div>
                    <h2 style="color: var(--primary);">JAMB Mastermind 3000+</h2>
                    <p style="color: #666;">Invoice #${transaction.id}</p>
                </div>
                
                <div style="border-top: 2px dashed #eee; border-bottom: 2px dashed #eee; padding: 30px 0; margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Date:</span>
                        <span style="font-weight: bold;">${invoiceDate.toLocaleDateString('en-NG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Customer:</span>
                        <span style="font-weight: bold;">${APP_STATE.currentUser.name}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Email:</span>
                        <span style="font-weight: bold;">${APP_STATE.currentUser.email}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Plan:</span>
                        <span style="font-weight: bold;">${transaction.plan}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Reference:</span>
                        <span style="font-weight: bold; font-size: 0.9rem;">${transaction.reference}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="color: #666;">Payment Method:</span>
                        <span style="font-weight: bold;">${transaction.paymentMethod}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 20px; font-size: 1.3rem;">
                        <span style="color: var(--primary);">Total:</span>
                        <span style="font-weight: bold; color: var(--primary);">₦${transaction.amount.toLocaleString()}</span>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button class="btn btn-primary" style="flex: 1;" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Invoice
                    </button>
                    <button class="btn btn-success" style="flex: 1;" onclick="closeInvoiceModal()">
                        <i class="fas fa-check"></i> Done
                    </button>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        function closeInvoiceModal() {
            document.getElementById('invoice-modal').style.display = 'none';
        }

        // =============== PREMIUM ACCESS CONTROL ===============
        function checkPremiumAndStart(subject) {
            if (APP_STATE.currentUser.plan === 'premium') {
                startSubjectPractice(subject);
            } else {
                showNotification('warning', '🔒 This subject requires Premium access. Upgrade to unlock all 3000+ questions!');
                setTimeout(() => openTab('billing-tab'), 2000);
            }
        }

        function checkPremiumAndStartMock(type, count, time) {
            if (APP_STATE.currentUser.plan === 'premium') {
                startMockExam(type, count, time);
            } else {
                showNotification('warning', '🔒 Mock exams require Premium access. Upgrade to take unlimited mocks!');
                setTimeout(() => openTab('billing-tab'), 2000);
            }
        }

        // =============== SESSION & USER FUNCTIONS ===============
        function startSessionTimer() {
            APP_STATE.sessionStartTime = new Date();
            APP_STATE.sessionTimer = setInterval(() => {
                const elapsed = Math.floor((new Date() - APP_STATE.sessionStartTime) / 1000);
                const hours = Math.floor(elapsed / 3600);
                const minutes = Math.floor((elapsed % 3600) / 60);
                const seconds = elapsed % 60;
                document.getElementById('session-time').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                APP_STATE.currentUser.studyTime = elapsed;
                document.getElementById('study-hours').textContent = Math.floor(elapsed / 3600);
            }, 1000);
        }

        function updateStats() {
            document.getElementById('questions-attempted').textContent = APP_STATE.currentUser.questionsAttempted;
            document.getElementById('total-score-display').textContent = APP_STATE.currentUser.totalScore;
            document.getElementById('streak-days').textContent = APP_STATE.currentUser.streakDays;
            
            const accuracy = APP_STATE.currentUser.questionsAttempted > 0 
                ? Math.round((APP_STATE.currentUser.correctAnswers / APP_STATE.currentUser.questionsAttempted) * 100)
                : 0;
            document.getElementById('accuracy-rate').textContent = `${accuracy}%`;
        }

        function updateQuestionCounts() {
            const subjects = ['english', 'math', 'physics', 'chemistry', 'biology', 'government', 'economics', 'literature'];
            subjects.forEach(subject => {
                const count = QUESTION_DATABASE[subject].length;
                const element = document.getElementById(`${subject}-count`);
                if (element) {
                    element.textContent = `${count}+ Questions`;
                }
            });
        }

        function saveUserData() {
            localStorage.setItem('jamb_user', JSON.stringify(APP_STATE.currentUser));
            localStorage.setItem('jamb_transactions', JSON.stringify(APP_STATE.transactions));
        }

        // =============== NAVIGATION ===============
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabName).style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'billing-tab') {
                loadBillingData();
            }
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('user-dropdown');
            dropdown.classList.toggle('show');
        }

        function viewProfile() {
            showNotification('info', 'Profile analytics coming soon!');
            toggleUserDropdown();
        }

        function viewAnalytics() {
            openTab('analytics-tab');
            toggleUserDropdown();
        }

        function logout() {
            if (confirm("End current study session?")) {
                clearInterval(APP_STATE.sessionTimer);
                saveUserData();
                showNotification('info', 'Session ended. See you next time!');
                setTimeout(() => location.reload(), 2000);
            }
            toggleUserDropdown();
        }

        // =============== PRACTICE FUNCTIONS ===============
        function startSubjectPractice(subject) {
            const subjectName = subject.charAt(0).toUpperCase() + subject.slice(1);
            APP_STATE.currentSession = {
                subject: subjectName,
                questions: getRandomQuestions(subject, 5),
                currentIndex: 0,
                score: 0,
                selectedAnswers: [],
                startTime: new Date(),
                isMockExam: false,
                timer: null,
                timeRemaining: 0
            };
            
            showQuizSection();
        }

        function getRandomQuestions(subject, count) {
            const allQuestions = QUESTION_DATABASE[subject];
            const shuffled = [...allQuestions].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count);
        }

        function showQuizSection() {
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            
            loadQuestion();
        }

        function loadQuestion() {
            const session = APP_STATE.currentSession;
            const question = session.questions[session.currentIndex];
            
            if (!question) {
                showResults();
                return;
            }
            
            const progress = ((session.currentIndex + 1) / session.questions.length) * 100;
            
            let html = `
                <div class="quiz-container">
                    <div class="quiz-header">
                        <div class="quiz-info">
                            <h2>${session.subject} ${session.isMockExam ? 'Mock Exam' : 'Practice'}</h2>
                            <p>Question ${session.currentIndex + 1} of ${session.questions.length}</p>
                        </div>
                        ${session.isMockExam ? `
                            <div class="quiz-timer" id="quiz-timer">
                                ${formatTimeRemaining(session.timeRemaining)}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="quiz-progress">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span>Progress</span>
                            <span><strong>${session.score}</strong> correct answers</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                    </div>
                    
                    <div class="question-card">
                        <div class="question-number">Question ${session.currentIndex + 1}</div>
                        <div class="question-text">
                            <strong>${question.question}</strong>
                        </div>
                        
                        <div class="options-grid">
            `;
            
            const optionLetters = ['A', 'B', 'C', 'D'];
            const selectedOption = session.selectedAnswers[session.currentIndex];
            
            question.options.forEach((option, index) => {
                const isSelected = selectedOption === index;
                html += `
                    <div class="option ${isSelected ? 'selected' : ''}" onclick="selectAnswer(${index})">
                        <span class="option-letter">${optionLetters[index]}</span>
                        <span>${option}</span>
                    </div>
                `;
            });
            
            html += `
                        </div>
                    </div>
                    
                    <div class="quiz-controls">
                        <button class="btn btn-outline" onclick="endPractice()">
                            <i class="fas fa-sign-out-alt"></i> End Practice
                        </button>
                        
                        <div style="display: flex; gap: 15px;">
                            ${session.currentIndex > 0 ? `
                                <button class="btn btn-secondary" onclick="previousQuestion()">
                                    <i class="fas fa-arrow-left"></i> Previous
                                </button>
                            ` : ''}
                            
                            <button class="btn btn-primary" onclick="submitAnswer()">
                                ${session.currentIndex === session.questions.length - 1 ? 'Finish' : 'Next'}
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('quiz-section').innerHTML = html;
        }

        function selectAnswer(index) {
            APP_STATE.currentSession.selectedAnswers[APP_STATE.currentSession.currentIndex] = index;
            loadQuestion();
        }

        function previousQuestion() {
            if (APP_STATE.currentSession.currentIndex > 0) {
                APP_STATE.currentSession.currentIndex--;
                loadQuestion();
            }
        }

        function submitAnswer() {
            const session = APP_STATE.currentSession;
            const question = session.questions[session.currentIndex];
            const selected = session.selectedAnswers[session.currentIndex];
            
            if (selected === undefined) {
                showNotification('warning', 'Please select an answer before proceeding!');
                return;
            }
            
            if (selected === question.correct) {
                session.score++;
                APP_STATE.currentUser.correctAnswers++;
            }
            
            APP_STATE.currentUser.questionsAttempted++;
            
            if (session.currentIndex < session.questions.length - 1) {
                session.currentIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function endPractice() {
            if (confirm("Are you sure you want to end this practice session? Your progress will be saved.")) {
                showResults();
            }
        }

        function showResults() {
            const session = APP_STATE.currentSession;
            const percentage = (session.score / session.questions.length) * 100;
            const timeTaken = new Date() - session.startTime;
            
            if (session.timer) {
                clearInterval(session.timer);
            }
            
            APP_STATE.currentUser.totalScore += session.score * 10;
            
            let html = `
                <div class="results-header">
                    <div class="result-icon">
                        ${percentage >= 70 ? '<i class="fas fa-trophy"></i>' : 
                          percentage >= 50 ? '<i class="fas fa-medal"></i>' : 
                          '<i class="fas fa-award"></i>'}
                    </div>
                    <h1>${session.isMockExam ? 'Mock Exam' : session.subject} Results</h1>
                    <div class="main-score">${session.score}/${session.questions.length}</div>
                    <div style="font-size: 2.5rem; color: ${percentage >= 70 ? 'var(--success)' : percentage >= 50 ? 'var(--warning)' : 'var(--danger)'}">
                        ${percentage.toFixed(1)}%
                    </div>
                    <p>Time Taken: ${formatTime(timeTaken)}</p>
                    <div class="performance-bar">
                        <div class="performance-fill" style="width: ${percentage}%"></div>
                    </div>
                </div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <h3>Correct Answers</h3>
                        <div class="value" style="color: var(--success);">${session.score}</div>
                    </div>
                    <div class="result-card">
                        <h3>Wrong Answers</h3>
                        <div class="value" style="color: var(--danger);">${session.questions.length - session.score}</div>
                    </div>
                    <div class="result-card">
                        <h3>Accuracy</h3>
                        <div class="value">${percentage.toFixed(1)}%</div>
                    </div>
                    <div class="result-card">
                        <h3>Score</h3>
                        <div class="value">${session.score * 10}</div>
                    </div>
                </div>
                
                <div class="detailed-results">
                    <h2 style="margin-bottom: 30px;">Question Review</h2>
            `;
            
            session.questions.forEach((q, index) => {
                const userAnswer = session.selectedAnswers[index];
                const isCorrect = userAnswer === q.correct;
                const optionLetters = ['A', 'B', 'C', 'D'];
                
                html += `
                    <div class="question-review">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>Q${index + 1}:</strong> ${q.question}
                                <div style="margin-top: 10px; font-size: 0.9rem;">
                                    <span style="color: ${isCorrect ? 'var(--success)' : 'var(--danger)'}">
                                        Your answer: ${userAnswer !== undefined ? optionLetters[userAnswer] : 'Not answered'}
                                    </span>
                                    <span style="color: var(--success); margin-left: 20px;">
                                        Correct: ${optionLetters[q.correct]}
                                    </span>
                                </div>
                                <div style="font-size: 0.85rem; color: #666; margin-top: 10px; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                                    <strong>Explanation:</strong> ${q.explanation}
                                </div>
                            </div>
                            <div>
                                ${isCorrect ? 
                                    '<i class="fas fa-check-circle" style="color: var(--success); font-size: 1.8rem;"></i>' : 
                                    '<i class="fas fa-times-circle" style="color: var(--danger); font-size: 1.8rem;"></i>'
                                }
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                
                <div style="text-align: center; margin-top: 50px;">
                    <button class="btn btn-primary" onclick="returnToDashboard()" style="padding: 18px 40px; font-size: 1.1rem;">
                        <i class="fas fa-home"></i> Return to Dashboard
                    </button>
                    ${session.isMockExam ? '' : `
                        <button class="btn btn-secondary" onclick="retryQuiz()" style="margin-left: 20px; padding: 18px 40px; font-size: 1.1rem;">
                            <i class="fas fa-redo"></i> Try Again
                        </button>
                    `}
                    <button class="btn btn-success" onclick="continuePractice()" style="margin-left: 20px; padding: 18px 40px; font-size: 1.1rem;">
                        <i class="fas fa-arrow-right"></i> Continue Practice
                    </button>
                </div>
            `;
            
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'block';
            document.getElementById('results-section').innerHTML = html;
            
            updateStats();
            saveUserData();
        }

        function returnToDashboard() {
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            openTab('practice-tab');
        }

        function retryQuiz() {
            const session = APP_STATE.currentSession;
            session.currentIndex = 0;
            session.score = 0;
            session.selectedAnswers = [];
            session.startTime = new Date();
            
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            loadQuestion();
        }

        function continuePractice() {
            if (APP_STATE.currentSession.subject) {
                startSubjectPractice(APP_STATE.currentSession.subject.toLowerCase());
            } else {
                returnToDashboard();
            }
        }

        // =============== MOCK EXAM FUNCTIONS ===============
        function startMockExam(type, questionCount, timeLimit) {
            APP_STATE.currentUser.mockExamsTaken++;
            document.getElementById('mock-attempts').textContent = APP_STATE.currentUser.mockExamsTaken;
            
            let allQuestions = [];
            const subjects = ['english', 'math', 'physics', 'chemistry', 'biology', 'government', 'economics', 'literature'];
            
            subjects.forEach(subject => {
                const subjectQuestions = getRandomQuestions(subject, Math.floor(questionCount / subjects.length));
                allQuestions = allQuestions.concat(subjectQuestions);
            });
            
            while (allQuestions.length < questionCount) {
                const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
                const extraQuestions = getRandomQuestions(randomSubject, 1);
                allQuestions = allQuestions.concat(extraQuestions);
            }
            
            allQuestions = shuffleArray(allQuestions).slice(0, questionCount);
            
            APP_STATE.currentSession = {
                subject: 'JAMB Mock Exam',
                questions: allQuestions,
                currentIndex: 0,
                score: 0,
                selectedAnswers: [],
                startTime: new Date(),
                isMockExam: true,
                mockConfig: { type, questionCount, timeLimit },
                timer: null,
                timeRemaining: timeLimit
            };
            
            showQuizSection();
            startMockTimer();
        }

        function startMockTimer() {
            const session = APP_STATE.currentSession;
            
            function updateTimer() {
                if (session.timeRemaining <= 0) {
                    clearInterval(session.timer);
                    showNotification('warning', 'Time is up! Submitting your exam...');
                    setTimeout(() => {
                        for (let i = session.currentIndex; i < session.questions.length; i++) {
                            if (session.selectedAnswers[i] === undefined) {
                                session.selectedAnswers[i] = 0;
                            }
                        }
                        showResults();
                    }, 1000);
                    return;
                }
                
                session.timeRemaining--;
                
                const timerElement = document.getElementById('quiz-timer');
                if (timerElement) {
                    timerElement.textContent = formatTimeRemaining(session.timeRemaining);
                    
                    if (session.timeRemaining < 300) {
                        timerElement.style.color = 'var(--danger)';
                        timerElement.classList.add('pulse');
                    } else if (session.timeRemaining < 600) {
                        timerElement.style.color = 'var(--warning)';
                    }
                }
            }
            
            session.timer = setInterval(updateTimer, 1000);
            updateTimer();
        }

        function quickRevision() {
            if (APP_STATE.currentUser.plan === 'premium') {
                const subjects = ['english', 'math', 'physics', 'chemistry', 'biology', 'government', 'economics', 'literature'];
                const selectedSubject = subjects[Math.floor(Math.random() * subjects.length)];
                startSubjectPractice(selectedSubject);
            } else {
                showNotification('warning', '🔒 Quick Revision requires Premium access. Upgrade to unlock!');
                setTimeout(() => openTab('billing-tab'), 2000);
            }
        }

        // =============== UTILITY FUNCTIONS ===============
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function formatTime(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes % 60}m ${seconds % 60}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${seconds % 60}s`;
            } else {
                return `${seconds}s`;
            }
        }

        function formatTimeRemaining(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                  type === 'error' ? 'exclamation-circle' : 
                                  type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 5000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const paymentModal = document.getElementById('payment-modal');
            const invoiceModal = document.getElementById('invoice-modal');
            
            if (event.target === paymentModal) {
                closePaymentModal();
            }
            if (event.target === invoiceModal) {
                closeInvoiceModal();
            }
        }
    </script>
</body>
</html>
